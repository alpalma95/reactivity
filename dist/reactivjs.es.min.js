const e=(e,t)=>(Array.isArray(e)&&(t=e,e={}),[e,t]),t=(e,t)=>{const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,(function(e){var n,r;return e.getAttribute("ref")==t||e.dataset.ref==t||e.getAttributeNames().some((e=>e.includes(":")))&&"createScope"===t?NodeFilter.FILTER_ACCEPT:null!=(n=e.getAttribute("ref"))&&n.toUpperCase().includes("CONTROLLER")||null!=(r=e.dataset.ref)&&r.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP})),r=[];let l;for(;l=n.nextNode();)r.push(l);return r},n=(e,t)=>"function"==typeof e?e(t):e.val??e;let r=null,l=new WeakMap;class o{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach((e=>e.delete(this)))}}let c=e=>{r=new o(e),r.cb();let t=r;return r=null,t},s=e=>{let t=(e=>{if(Array.isArray(e)||"function"!=typeof e&&"object"!=typeof e)return{val:e};if("function"==typeof e){let t=s(1);return c((()=>t.val=e())),t}return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"object"==typeof t||"function"==typeof t?s(t):t])))})(e);return new Proxy(t,{get:(e,t,n)=>(((e,t)=>{if(null===r)return;let n=((e,t,n)=>{let r;return e.has(t)&&e.get(t).has(n)?r=e.get(t).get(n):e.has(t)&&!e.get(t).has(n)?e.get(t).set(n,r=new Set):e.set(t,new Map([[n,r=new Set]])),r})(l,e,t);r._set.add(n),n.add(r)})(e,t),Reflect.get(e,t,n)),set:(e,t,n,r)=>{return e[t]!==n&&(Reflect.set(e,t,n,r),o=e,c=t,l.get(o)&&l.get(o).get(c).forEach((({cb:e})=>e()))),!0;var o,c}})};const a={selector:"rv-class",construct:function({element:e},t){return Object.entries(t).reduce(((t,[r,l])=>{let o=c((()=>{!e.classList.contains(r)&&n(l,e)&&e.classList.add(r),e.classList.contains(r)&&!n(l,e)&&e.classList.remove(r)}));return t.push(o),t}),[])}},i=new WeakMap,u=(e,t)=>{let{isArray:n}=Array,r=i.get(e);r?i.set(e,n(t)?[...r,...t]:[...r,t]):i.set(e,[t])},m=e=>{var t;"function"==typeof(null==e?void 0:e.destroy)&&e.destroy(e),null==(t=i.get(e))||t.forEach((e=>{e.unhook()})),i.delete(e),null==e||e.remove()},f=(e,t,r)=>{let l=c((()=>e.setAttribute(t,n(r,e))));u(e,l)};class d extends Array{mount(e){return this.forEach((t=>e(t))),this}}const p=(e,t=[])=>{e.$=h(e),e.mount=function(t){t(e)},e.setProps=function(n){A({element:e,ctx:n}),t.length&&C(e,t)}},h=(n=document)=>new Proxy({},{get:(r,l)=>function(r,o=[]){let[c,s]=e(r,o);const a=[...t(n,l)];let i="createScope"===l?c:null;return i&&a.push(n),a.forEach((e=>{i&&(c=((e,t)=>{var n;return null==(n=e.getAttributeNames())?void 0:n.reduce(((n,r)=>(r.startsWith(":")&&":"!==r&&(n[r.replaceAll(":","")]=t[e.getAttribute(r)]??e.getAttribute(r))&&e.removeAttribute(r),":"===r&&(n[e.tagName.toLowerCase()]=t[e.getAttribute(r)])&&e.removeAttribute(r),n)),{})})(e,i));const t={element:e,ctx:c};A(t),C(e,s),p(e,c),t.element.init&&"function"==typeof t.element.init&&t.element.init()})),1===a.length?a[0]:new d(...a)}}),y=h(),v={INPUT:{checkbox:"checked"}},g={selector:"rv-text",construct:function(e,t){var r;let l=null;return(null==(r=e.element.tagName)?void 0:r.toLowerCase())===this.selector&&(l=new Text,e.element.replaceWith(l)),c((()=>{e.element.textContent===n(t,e.element)||(null==l?void 0:l.textContent)===n(t,e.element)||e.element instanceof Comment||(l?l.textContent=n(t,l):e.element.textContent=n(t,e.element))}))}},E=[{selector:"rv-for",construct:function({element:e},t){var n;let r,[l,o,a]=t;null!=(n=e.dataset)&&n.populate&&(l.val=JSON.parse(e.dataset.populate),e.removeAttribute("data-populate"),r=((e,t)=>{var n;const r=(null==(n=e.children[0])?void 0:n.cloneNode(!0))??e.querySelector("template").content.children[0];return p(r),e=>(t(e)(r),r)})(e,o));const i=s((()=>a?l.val.map(a):l.val));return r&&i.val.forEach(((t,n)=>{const r=e.children[n];p(r),o(t,n)(r)})),c((()=>{((e,t,n)=>{const r=t.children,{trackBy:l}=t.dataset;e.length<r.length&&[...r].filter((t=>!e.some((e=>t.dataset.key==e[l])))).forEach((e=>{m(t.querySelector(`[data-key="${e.dataset.key}"]`))})),e.forEach(((o,c)=>{r[c]||t.appendChild(n(o,c));const s=o[l]==r[c].dataset.key,a=e.length===r.length,i=`[data-key="${o[l]}"]`;if(!s&&a){const e=t.querySelector(i)??n(o,c);t.replaceChild(e,r[c])}if(!s&&!a){const e=t.querySelector(i)??n(o,c);t.insertBefore(e,r[c])}}))})(i.val,e,r??o)}))}},g,a,{selector:"rv-show",construct:function({element:e},t){return c((()=>e.style.display=n(t,e)?null:"none"))}},{selector:"rv-if",construct:function(e,t){let r=new Comment("rv-if");return c((()=>{!n(t,e.element)&&!e.element.parentElement&&(e.replaceWith=r),r.parentElement&&n(t,e.element)&&(r.replaceWith(e.element),"function"==typeof e.element.init&&e.element.init(e.element)),e.element.parentElement&&!n(t,e.element)&&("function"==typeof e.element.destroy&&e.element.destroy(e.element),e.element.replaceWith(r))}))}},{selector:"rv-model",construct:function({element:e},t){let n=v[e.tagName]??"value";return e instanceof HTMLInputElement&&(n=v.INPUT[e.type]??"value"),e.addEventListener("input",(()=>{t.val=e[n]})),c((()=>{e[n]=t.val}))}}],x=Object.fromEntries(E.map((e=>[e.selector,e]))),b=(...e)=>{e.forEach((e=>x[e.selector]=e))},A=e=>{for(const t in e.ctx){let n=x[t];const r=t.startsWith("on")&&"function"==typeof e.ctx[t];if("init"!==t&&"destroy"!==t)if(n){let r=n.construct(e,e.ctx[t]);r&&u(e.element,r)}else r?e.element.addEventListener(t.slice(2),e.ctx[t]):"function"!=typeof e.ctx[t]&&"object"!=typeof e.ctx[t]?e.element.setAttribute(t,e.ctx[t]):f(e.element,t,e.ctx[t]);else e.element[t]=e.ctx[t]}},C=(e,t)=>{t.length&&t.forEach((t=>{let n=t instanceof HTMLElement||t instanceof Comment||t instanceof DocumentFragment?t:new Text(t);"function"==typeof t&&u(n,g.construct({element:n},t)),e.appendChild(n)}))},w=new Proxy({},{get:function(t,n){return n in t||Reflect.set(t,n,(t=>function(n,r=[]){let[l,o]=e(n,r),c={element:"fragment"===t?new DocumentFragment:document.createElement(t),ctx:l};return A(c),C(c.element,o),c.element.init&&"function"==typeof c.element.init&&c.element.init(),c.replaceWith??c.element})(n)),t[n]}});export{y as $,w as h,c as hook,b as registerDirectives,m as safeRemove,s as stream};
//# sourceMappingURL=reactivjs.min.js.map