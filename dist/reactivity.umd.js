(function(a,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(a=typeof globalThis<"u"?globalThis:a||self,l(a.reactivity={}))})(this,function(a){"use strict";let l=null,p=new WeakMap;class j{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let h=t=>{l=new j(t),l.cb();let e=l;return l=null,e},q=(t,e)=>{if(l===null)return;let n;p.has(t)?n=p.get(t).get(e):p.set(t,new Map([[e,n=new Set]])),l._set.add(n),n.add(l)},L=(t,e,n)=>{if(!p.get(t))return;p.get(t).get(e).forEach(({cb:s})=>s(n))},R=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=g(1);return h(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?g(n):n]))},g=t=>{let e=R(t);return new Proxy(e,{get(n,r,s){return q(n,r),Reflect.get(n,r,s)},set(n,r,s,c){if(n[r]!==s){let o=n[r];Reflect.set(n,r,s,c),L(n,r,o)}return!0}})};const y=new WeakMap,A=(t,e)=>y.has(t)?y.get(t).push(e):y.set(t,[e]),C=t=>{var e;typeof t.destroy=="function"&&t.destroy(t),(e=y.get(t))==null||e.forEach(n=>{Array.isArray(n)?n.forEach(r=>r.unhook()):n.unhook()}),y.delete(t),t==null||t.remove()},W=(t,e,n)=>{let r=h(()=>t.setAttribute(e,n(t)));A(t,r)},x=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),D={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,s]of Object.entries(e)){let c=h(()=>{!t.classList.contains(r)&&s(t)&&t.classList.add(r),t.classList.contains(r)&&!s(t)&&t.classList.remove(r)});n.push(c)}return n}},w=(t,e,n,r,s,c,o=null)=>{const i=t.clone.cloneNode(!0);if(i.setAttribute("ref",e[r]),c==="append"&&n.appendChild(i),c==="replace"||c==="insert"){const f=n.querySelector(`[data-key="${e[r]}"]`)??i;c==="replace"?n.replaceChild(f,s[o]):n.insertBefore(i,s[o]),f==i&&n.$[e[r]]().mount(t.template(e))}n.$[e[r]]().mount(t.template(e))},P=(t,e,n)=>{const r=e.children,{trackBy:s}=e.dataset;t.length<r.length&&[...r].filter(o=>!t.some(i=>o.dataset.key==i[s])).forEach(o=>{C(e.querySelector(`[data-key="${o.dataset.key}"]`))}),t.forEach((c,o)=>{r[o]||(n.clone||e.appendChild(n.template(c)),n.clone&&w(n,c,e,s,r,"append"));const i=c[s]==r[o].dataset.key,f=t.length===r.length,u=`[data-key="${c[s]}"]`;if(!i&&f){if(!n.clone){const d=e.querySelector(u)??n.template(c);e.replaceChild(d,r[o])}n.clone&&w(n,c,e,s,r,"replace",o)}if(!i&&!f){if(!n.clone){const d=e.querySelector(u)??n.template(c);e.insertBefore(d,r[o])}n.clone&&w(n,c,e,s,r,"insert",o)}})},S=[{selector:"data-for",construct:function({element:t},e){var c,o;const[n,r]=e,s={template:r,clone:null};if(!n.val.length&&t.children.length){let i=[...t.querySelectorAll("[data-populate]")];i.forEach(u=>{const d=JSON.parse(u.dataset.populate);Object.keys(d).length&&(n.val=[...n.val,d]),u.removeAttribute("data-populate")});let f=(c=i[0])==null?void 0:c.getAttribute("ref");console.log(n.val),n.val.length&&((o=n.val)==null||o.forEach((u,d)=>{const E=t.$[f]();E.length===1?E.mount(s.template(u)):E[d].mount(s.template(u))})),s.clone=i[0].cloneNode(!0)}return h(()=>{P(n.val,t,s)})}},{selector:"data-text",construct:function({element:t},e){return h(()=>{t.textContent===e(t)||t instanceof Comment||(t.textContent=e(t))})}},D,{selector:"data-show",construct:function({element:t},e){return h(()=>t.style.display=e(t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return h(()=>{!e(t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&e(t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!e(t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}}],_=Object.fromEntries(S.map(t=>[t.selector,t])),F=t=>{S.push(t)},m=t=>{for(const e in t.ctx){let n=_[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"){t.ctx[e](t.element),t.element.init=t.ctx[e];continue}if(e==="destroy"){t.element.destroy=t.ctx[e];continue}if(n){let s=n.construct(t,t.ctx[e]);A(t.element,s);continue}if(!n&&typeof t.ctx[e]=="function"&&!r){W(t.element,e,t.ctx[e]);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},v=(t,e)=>{e.length&&e.forEach(n=>{let r;n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?r=n:r=new Text(n),t.appendChild(r)})},H=t=>function(e,n=[]){let[r,s]=x(e,n),c={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return m(c),v(c.element,s),c.replaceWith??c.element},T=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,H(e)),t[e]}});class I extends Array{mount(e){return this.forEach(n=>e(n)),this}}const $=(t=document)=>new Proxy({},{get:(e,n)=>function(r,s=[]){let[c,o]=x(r,s);const i=[...t.querySelectorAll(`[ref="${n}"]`)];return i.forEach(f=>{m({element:f,ctx:c}),v(f,o),f.$=$(f),f.mount=function(u){u(f)},f.props=function(u){m({element:f,ctx:u}),v(f,o)}}),i.length===1?i[0]:new I(...i)}}),J=$();a.$=J,a.h=T,a.hook=h,a.registerDirective=F,a.safeRemove=C,a.stream=g,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
