(function(f,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(f=typeof globalThis<"u"?globalThis:f||self,p(f.reactivity={}))})(this,function(f){"use strict";const p=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),S=(t,e)=>{const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(c){var o;return c.getAttribute("ref")==e||c.getAttributeNames().some(u=>u.includes(":"))&&e==="createScope"?NodeFilter.FILTER_ACCEPT:(o=c.getAttribute("ref"))!=null&&o.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let s;for(;s=r.nextNode();)n.push(s);return n},a=(t,e)=>typeof t=="function"?t(e):t.val??t;let h=null,y=new WeakMap;class R{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let d=t=>{h=new R(t),h.cb();let e=h;return h=null,e},T=(t,e)=>{if(h===null)return;let n;y.has(t)?n=y.get(t).get(e):y.set(t,new Map([[e,n=new Set]])),h._set.add(n),n.add(h)},D=(t,e,n)=>{if(!y.get(t))return;y.get(t).get(e).forEach(({cb:s})=>s(n))},W=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=g(1);return d(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?g(n):n]))},g=t=>{let e=W(t);return new Proxy(e,{get(n,r,s){return T(n,r),Reflect.get(n,r,s)},set(n,r,s,c){if(n[r]!==s){let o=n[r];Reflect.set(n,r,s,c),D(n,r,o)}return!0}})};const j={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,s]of Object.entries(e)){let c=d(()=>{!t.classList.contains(r)&&a(s,t)&&t.classList.add(r),t.classList.contains(r)&&!a(s,t)&&t.classList.remove(r)});n.push(c)}return n}},E=new WeakMap,x=(t,e)=>{let{isArray:n}=Array,r=E.get(t);r?E.set(t,n(e)?[...r,...e]:[...r,e]):E.set(t,[e])},A=t=>{var e;typeof t.destroy=="function"&&t.destroy(t),(e=E.get(t))==null||e.forEach(n=>{n.unhook()}),E.delete(t),t==null||t.remove()},F=(t,e,n)=>{let r=d(()=>t.setAttribute(e,a(n,t)));x(t,r)},P=(t,e,n)=>{const r=e.children,{trackBy:s}=e.dataset;t.length<r.length&&[...r].filter(o=>!t.some(u=>o.dataset.key==u[s])).forEach(o=>{A(e.querySelector(`[data-key="${o.dataset.key}"]`))}),t.forEach((c,o)=>{r[o]||e.appendChild(n(c));const u=c[s]==r[o].dataset.key,m=t.length===r.length,i=`[data-key="${c[s]}"]`;if(!u&&m){const l=e.querySelector(i)??n(c);e.replaceChild(l,r[o])}if(!u&&!m){const l=e.querySelector(i)??n(c);e.insertBefore(l,r[o])}})},C=[{selector:"data-for",construct:function({element:t},e){const[n,r]=e;return d(()=>{P(n.val,t,r)})}},{selector:"data-text",construct:function({element:t},e){return d(()=>{t.textContent===a(e,t)||t instanceof Comment||(t.textContent=a(e,t))})}},j,{selector:"data-show",construct:function({element:t},e){return d(()=>t.style.display=a(e,t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return d(()=>{!a(e,t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&a(e,t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!a(e,t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}},{selector:"data-model",construct:function({element:t},e){return t.addEventListener("input",()=>{e.val=t.value}),d(()=>{t.value=e.val})}}],_=Object.fromEntries(C.map(t=>[t.selector,t])),N=t=>{C.push(t)},w=t=>{for(const e in t.ctx){let n=_[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"||e==="destroy"){e==="init"&&t.ctx[e](t.element),t.element[e]=t.ctx[e];continue}if(n){let s=n.construct(t,t.ctx[e]);x(t.element,s);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}if(typeof t.ctx[e]=="function"||typeof t.ctx[e]=="object"){F(t.element,e,t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},v=(t,e)=>{e.length&&e.forEach(n=>{let r=n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?n:new Text(n);t.appendChild(r)})},q=t=>function(e,n=[]){let[r,s]=p(e,n),c={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return w(c),v(c.element,s),c.replaceWith??c.element},I=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,q(e)),t[e]}});class $ extends Array{mount(e){return this.forEach(n=>e(n)),this}}const B=(t,e)=>{var r;let n={};return(r=t.getAttributeNames())==null||r.forEach(s=>{s.startsWith(":")&&(n[s.replaceAll(":","")]=e[t.getAttribute(s)])&&t.removeAttribute(s)}),n},L=(t=document)=>new Proxy({},{get:(e,n)=>function(r,s=[]){let[c,o]=p(r,s);const u=[...S(t,n)];let m=n==="createScope"?c:null;return u.forEach(i=>{m&&(c=B(i,m)),w({element:i,ctx:c}),v(i,o),i.$=L(i),i.mount=function(l){l(i)},i.props=function(l){w({element:i,ctx:l}),v(i,o)}}),u.length===1?u[0]:new $(...u)}}),H=L();f.$=H,f.h=I,f.hook=d,f.registerDirective=N,f.safeRemove=A,f.stream=g,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
