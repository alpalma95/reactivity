(function(f,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(f=typeof globalThis<"u"?globalThis:f||self,u(f.reactivity={}))})(this,function(f){"use strict";let u=null,l=new WeakMap;class A{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let a=t=>{u=new A(t),u.cb();let e=u;return u=null,e},R=(t,e)=>{if(u===null)return;let n;l.has(t)?n=l.get(t).get(e):l.set(t,new Map([[e,n=new Set]])),u._set.add(n),n.add(u)},T=(t,e,n)=>{if(!l.get(t))return;l.get(t).get(e).forEach(({cb:s})=>s(n))},S=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=y(1);return a(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?y(n):n]))},y=t=>{let e=S(t);return new Proxy(e,{get(n,r,s){return R(n,r),Reflect.get(n,r,s)},set(n,r,s,c){if(n[r]!==s){let i=n[r];Reflect.set(n,r,s,c),T(n,r,i)}return!0}})};const p=new WeakMap,g=(t,e)=>p.has(t)?p.get(t).push(e):p.set(t,[e]),v=t=>{var e;typeof t.destroy=="function"&&t.destroy(t),(e=p.get(t))==null||e.forEach(n=>{Array.isArray(n)?n.forEach(r=>r.unhook()):n.unhook()}),p.delete(t),t==null||t.remove()},D=(t,e,n)=>{let r=a(()=>t.setAttribute(e,n(t)));g(t,r)},x=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),F=(t,e)=>{const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(c){var i;return c.getAttribute("ref")==e?NodeFilter.FILTER_ACCEPT:(i=c.getAttribute("ref"))!=null&&i.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let s;for(;s=r.nextNode();)n.push(s);return n},W={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,s]of Object.entries(e)){let c=a(()=>{!t.classList.contains(r)&&s(t)&&t.classList.add(r),t.classList.contains(r)&&!s(t)&&t.classList.remove(r)});n.push(c)}return n}},j=(t,e,n)=>{const r=e.children,{trackBy:s}=e.dataset;t.length<r.length&&[...r].filter(i=>!t.some(d=>i.dataset.key==d[s])).forEach(i=>{v(e.querySelector(`[data-key="${i.dataset.key}"]`))}),t.forEach((c,i)=>{r[i]||e.appendChild(n(c));const d=c[s]==r[i].dataset.key,o=t.length===r.length,h=`[data-key="${c[s]}"]`;if(!d&&o){const w=e.querySelector(h)??n(c);e.replaceChild(w,r[i])}if(!d&&!o){const w=e.querySelector(h)??n(c);e.insertBefore(w,r[i])}})},C=[{selector:"data-for",construct:function({element:t},e){const[n,r]=e;return a(()=>{j(n.val,t,r)})}},{selector:"data-text",construct:function({element:t},e){return a(()=>{t.textContent===e(t)||t instanceof Comment||(t.textContent=e(t))})}},W,{selector:"data-show",construct:function({element:t},e){return a(()=>t.style.display=e(t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return a(()=>{!e(t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&e(t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!e(t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}},{selector:"data-model",construct:function({element:t},e){return t.addEventListener("input",()=>{e.val=t.value}),a(()=>{t.value=e.val})}}],P=Object.fromEntries(C.map(t=>[t.selector,t])),_=t=>{C.push(t)},E=t=>{for(const e in t.ctx){let n=P[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"){t.ctx[e](t.element),t.element.init=t.ctx[e];continue}if(e==="destroy"){t.element.destroy=t.ctx[e];continue}if(n){let s=n.construct(t,t.ctx[e]);g(t.element,s);continue}if(!n&&typeof t.ctx[e]=="function"&&!r){D(t.element,e,t.ctx[e]);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},m=(t,e)=>{e.length&&e.forEach(n=>{let r;n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?r=n:r=new Text(n),t.appendChild(r)})},q=t=>function(e,n=[]){let[r,s]=x(e,n),c={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return E(c),m(c.element,s),c.replaceWith??c.element},I=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,q(e)),t[e]}});class $ extends Array{mount(e){return this.forEach(n=>e(n)),this}}const L=(t=document)=>new Proxy({},{get:(e,n)=>function(r,s=[]){let[c,i]=x(r,s);const d=[...F(t,n)];return d.forEach(o=>{E({element:o,ctx:c}),m(o,i),o.$=L(o),o.mount=function(h){h(o)},o.props=function(h){E({element:o,ctx:h}),m(o,i)}}),d.length===1?d[0]:new $(...d)}}),N=L();f.$=N,f.h=I,f.hook=a,f.registerDirective=_,f.safeRemove=v,f.stream=y,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
