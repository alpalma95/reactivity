(function(f,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(f=typeof globalThis<"u"?globalThis:f||self,u(f.reactivity={}))})(this,function(f){"use strict";let u=null,l=new WeakMap;class R{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let a=t=>{u=new R(t),u.cb();let e=u;return u=null,e},T=(t,e)=>{if(u===null)return;let n;l.has(t)?n=l.get(t).get(e):l.set(t,new Map([[e,n=new Set]])),u._set.add(n),n.add(u)},D=(t,e,n)=>{if(!l.get(t))return;l.get(t).get(e).forEach(({cb:s})=>s(n))},W=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=E(1);return a(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?E(n):n]))},E=t=>{let e=W(t);return new Proxy(e,{get(n,r,s){return T(n,r),Reflect.get(n,r,s)},set(n,r,s,c){if(n[r]!==s){let o=n[r];Reflect.set(n,r,s,c),D(n,r,o)}return!0}})};const p=new WeakMap,A=(t,e)=>p.has(t)?p.get(t).push(e):p.set(t,[e]),v=t=>{var e;typeof t.destroy=="function"&&t.destroy(t),(e=p.get(t))==null||e.forEach(n=>{Array.isArray(n)?n.forEach(r=>r.unhook()):n.unhook()}),p.delete(t),t==null||t.remove()},F=(t,e,n)=>{let r=a(()=>t.setAttribute(e,n(t)));A(t,r)},x=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),P=(t,e)=>{const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(c){var o;return c.getAttribute("ref")==e||c.getAttributeNames().includes("ref")&&e==="createScope"?NodeFilter.FILTER_ACCEPT:(o=c.getAttribute("ref"))!=null&&o.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let s;for(;s=r.nextNode();)n.push(s);return n},j={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,s]of Object.entries(e)){let c=a(()=>{!t.classList.contains(r)&&s(t)&&t.classList.add(r),t.classList.contains(r)&&!s(t)&&t.classList.remove(r)});n.push(c)}return n}},_=(t,e,n)=>{const r=e.children,{trackBy:s}=e.dataset;t.length<r.length&&[...r].filter(o=>!t.some(d=>o.dataset.key==d[s])).forEach(o=>{v(e.querySelector(`[data-key="${o.dataset.key}"]`))}),t.forEach((c,o)=>{r[o]||e.appendChild(n(c));const d=c[s]==r[o].dataset.key,y=t.length===r.length,i=`[data-key="${c[s]}"]`;if(!d&&y){const h=e.querySelector(i)??n(c);e.replaceChild(h,r[o])}if(!d&&!y){const h=e.querySelector(i)??n(c);e.insertBefore(h,r[o])}})},C=[{selector:"data-for",construct:function({element:t},e){const[n,r]=e;return a(()=>{_(n.val,t,r)})}},{selector:"data-text",construct:function({element:t},e){return a(()=>{t.textContent===e(t)||t instanceof Comment||(t.textContent=e(t))})}},j,{selector:"data-show",construct:function({element:t},e){return a(()=>t.style.display=e(t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return a(()=>{!e(t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&e(t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!e(t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}},{selector:"data-model",construct:function({element:t},e){return t.addEventListener("input",()=>{e.val=t.value}),a(()=>{t.value=e.val})}}],L=Object.fromEntries(C.map(t=>[t.selector,t])),N=t=>{C.push(t)},g=t=>{for(const e in t.ctx){let n=L[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"){t.ctx[e](t.element),t.element.init=t.ctx[e];continue}if(e==="destroy"){t.element.destroy=t.ctx[e];continue}if(n){let s=n.construct(t,t.ctx[e]);A(t.element,s);continue}if(!n&&typeof t.ctx[e]=="function"&&!r){F(t.element,e,t.ctx[e]);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},m=(t,e)=>{e.length&&e.forEach(n=>{let r;n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?r=n:r=new Text(n),t.appendChild(r)})},q=t=>function(e,n=[]){let[r,s]=x(e,n),c={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return g(c),m(c.element,s),c.replaceWith??c.element},I=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,q(e)),t[e]}});class $ extends Array{mount(e){return this.forEach(n=>e(n)),this}}const w=(t,e,n)=>n[t.getAttribute(e)],B=(t,e)=>{const n=t.getAttributeNames();let r={};return n.forEach(s=>{s.startsWith("on:")&&(r[s.replaceAll(":","")]=w(t,s,e))&&t.removeAttribute(s),s.startsWith(":")&&(r[s.replaceAll(":","")]=w(t,s,e))&&t.removeAttribute(s),L.hasOwnProperty(s)&&(r[s]=w(t,s,e))&&t.removeAttribute(s)}),r},S=(t=document)=>new Proxy({},{get:(e,n)=>function(r,s=[]){let[c,o]=x(r,s);const d=[...P(t,n)];let y=n==="createScope"?c:null;return d.forEach(i=>{y&&(c=B(i,y)),g({element:i,ctx:c}),m(i,o),i.$=S(i),i.mount=function(h){h(i)},i.props=function(h){g({element:i,ctx:h}),m(i,o)}}),d.length===1?d[0]:new $(...d)}}),H=S();f.$=H,f.h=I,f.hook=a,f.registerDirective=N,f.safeRemove=v,f.stream=E,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
