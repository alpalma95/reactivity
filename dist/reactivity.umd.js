(function(f,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(f=typeof globalThis<"u"?globalThis:f||self,h(f.reactivity={}))})(this,function(f){"use strict";const h=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),S=(t,e)=>{const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(c){var o;return c.getAttribute("ref")==e||c.getAttributeNames().some(u=>u.includes(":"))&&e==="createScope"?NodeFilter.FILTER_ACCEPT:(o=c.getAttribute("ref"))!=null&&o.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let s;for(;s=r.nextNode();)n.push(s);return n},p=(t,e)=>typeof t=="function"?t(e):t.val??t;let d=null,y=new WeakMap;class T{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let a=t=>{d=new T(t),d.cb();let e=d;return d=null,e},R=(t,e)=>{if(d===null)return;let n;y.has(t)?n=y.get(t).get(e):y.set(t,new Map([[e,n=new Set]])),d._set.add(n),n.add(d)},D=(t,e,n)=>{if(!y.get(t))return;y.get(t).get(e).forEach(({cb:s})=>s(n))},W=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=v(1);return a(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?v(n):n]))},v=t=>{let e=W(t);return new Proxy(e,{get(n,r,s){return R(n,r),Reflect.get(n,r,s)},set(n,r,s,c){if(n[r]!==s){let o=n[r];Reflect.set(n,r,s,c),D(n,r,o)}return!0}})};const F={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,s]of Object.entries(e)){let c=a(()=>{!t.classList.contains(r)&&p(s,t)&&t.classList.add(r),t.classList.contains(r)&&!p(s,t)&&t.classList.remove(r)});n.push(c)}return n}},E=new WeakMap,A=(t,e)=>{let{isArray:n}=Array,r=E.get(t);r?E.set(t,n(e)?[...r,...e]:[...r,e]):E.set(t,[e])},C=t=>{var e;typeof t.destroy=="function"&&t.destroy(t),(e=E.get(t))==null||e.forEach(n=>{n.unhook()}),E.delete(t),t==null||t.remove()},j=(t,e,n)=>{let r=a(()=>t.setAttribute(e,n(t)));A(t,r)},P=(t,e,n)=>{const r=e.children,{trackBy:s}=e.dataset;t.length<r.length&&[...r].filter(o=>!t.some(u=>o.dataset.key==u[s])).forEach(o=>{C(e.querySelector(`[data-key="${o.dataset.key}"]`))}),t.forEach((c,o)=>{r[o]||e.appendChild(n(c));const u=c[s]==r[o].dataset.key,m=t.length===r.length,i=`[data-key="${c[s]}"]`;if(!u&&m){const l=e.querySelector(i)??n(c);e.replaceChild(l,r[o])}if(!u&&!m){const l=e.querySelector(i)??n(c);e.insertBefore(l,r[o])}})},g=[{selector:"data-for",construct:function({element:t},e){const[n,r]=e;return a(()=>{P(n.val,t,r)})}},{selector:"data-text",construct:function({element:t},e){return a(()=>{let n=typeof e=="function"?e(t):(e==null?void 0:e.val)??e;t.textContent===n||t instanceof Comment||(t.textContent=n)})}},F,{selector:"data-show",construct:function({element:t},e){return a(()=>t.style.display=p(e,t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return a(()=>{!p(e,t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&p(e,t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!p(e,t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}},{selector:"data-model",construct:function({element:t},e){return t.addEventListener("input",()=>{e.val=t.value}),a(()=>{t.value=e.val})}}],_=Object.fromEntries(g.map(t=>[t.selector,t])),N=t=>{g.push(t)},w=t=>{for(const e in t.ctx){let n=_[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"||e==="destroy"){e==="init"&&t.ctx[e](t.element),t.element[e]=t.ctx[e];continue}if(n){let s=n.construct(t,t.ctx[e]);A(t.element,s);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}if(typeof t.ctx[e]=="function"){j(t.element,e,t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},x=(t,e)=>{e.length&&e.forEach(n=>{let r=n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?n:new Text(n);t.appendChild(r)})},q=t=>function(e,n=[]){let[r,s]=h(e,n),c={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return w(c),x(c.element,s),c.replaceWith??c.element},I=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,q(e)),t[e]}});class $ extends Array{mount(e){return this.forEach(n=>e(n)),this}}const H=(t,e)=>{var r;let n={};return(r=t.getAttributeNames())==null||r.forEach(s=>{s.startsWith(":")&&(n[s.replaceAll(":","")]=e[t.getAttribute(s)])&&t.removeAttribute(s)}),n},L=(t=document)=>new Proxy({},{get:(e,n)=>function(r,s=[]){let[c,o]=h(r,s);const u=[...S(t,n)];let m=n==="createScope"?c:null;return u.forEach(i=>{m&&(c=H(i,m)),w({element:i,ctx:c}),x(i,o),i.$=L(i),i.mount=function(l){l(i)},i.props=function(l){w({element:i,ctx:l}),x(i,o)}}),u.length===1?u[0]:new $(...u)}}),M=L();f.$=M,f.h=I,f.hook=a,f.registerDirective=N,f.safeRemove=C,f.stream=v,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
