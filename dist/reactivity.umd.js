(function(f,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(f=typeof globalThis<"u"?globalThis:f||self,u(f.reactivity={}))})(this,function(f){"use strict";let u=null,y=new WeakMap;class S{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let d=t=>{u=new S(t),u.cb();let e=u;return u=null,e},D=(t,e)=>{if(u===null)return;let n;y.has(t)?n=y.get(t).get(e):y.set(t,new Map([[e,n=new Set]])),u._set.add(n),n.add(u)},j=(t,e,n)=>{if(!y.get(t))return;y.get(t).get(e).forEach(({cb:s})=>s(n))},L=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=l(1);return d(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?l(n):n]))},l=t=>{let e=L(t);return new Proxy(e,{get(n,r,s){return D(n,r),Reflect.get(n,r,s)},set(n,r,s,c){if(n[r]!==s){let i=n[r];Reflect.set(n,r,s,c),j(n,r,i)}return!0}})};const p=new WeakMap,g=(t,e)=>p.has(t)?p.get(t).push(e):p.set(t,[e]),x=t=>{var e;typeof t.destroy=="function"&&t.destroy(t),(e=p.get(t))==null||e.forEach(n=>{Array.isArray(n)?n.forEach(r=>r.unhook()):n.unhook()}),p.delete(t),t==null||t.remove()},W=(t,e,n)=>{let r=d(()=>t.setAttribute(e,n(t)));g(t,r)},v=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),q={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,s]of Object.entries(e)){let c=d(()=>{!t.classList.contains(r)&&s(t)&&t.classList.add(r),t.classList.contains(r)&&!s(t)&&t.classList.remove(r)});n.push(c)}return n}},P=(t,e,n=null)=>{const r=e.children,{trackBy:s}=e.dataset;if(t.length<r.length){[...r].filter(i=>!t.some(a=>i.dataset.key==a[s])).forEach(i=>{x(e.querySelector(`[data-key="${i.dataset.key}"]`))});return}t.forEach((c,i)=>{r[i]||e.appendChild(n(c));const a=c[s]==r[i].dataset.key,o=t.length===r.length,h=`[data-key="${c[s]}"]`;if(!a&&o){const E=e.querySelector(h)??n(c);e.replaceChild(E,r[i])}if(!a&&!o){const E=e.querySelector(h)??n(c);e.insertBefore(E,r[i])}})},C=[{selector:"data-for",construct:function({element:t},e){return d(()=>{P(e.at(0).val,t,e.at(-1))})}},{selector:"data-text",construct:function({element:t},e){return d(()=>{t.textContent===e(t)||t instanceof Comment||(t.textContent=e(t))})}},q,{selector:"data-show",construct:function({element:t},e){return d(()=>t.style.display=e(t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return d(()=>{!e(t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&e(t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!e(t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}}],R=Object.fromEntries(C.map(t=>[t.selector,t])),$=t=>{C.push(t)},m=t=>{for(const e in t.ctx){let n=R[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"){t.ctx[e](t.element),t.element.init=t.ctx[e];continue}if(e==="destroy"){t.element.destroy=t.ctx[e];continue}if(n){let s=n.construct(t,t.ctx[e]);g(t.element,s);continue}if(!n&&typeof t.ctx[e]=="function"&&!r){W(t.element,e,t.ctx[e]);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},w=(t,e)=>{e.length&&e.forEach(n=>{let r;n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?r=n:r=new Text(n),t.appendChild(r)})},T=t=>function(e,n=[]){let[r,s]=v(e,n),c={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return m(c),w(c.element,s),c.replaceWith??c.element},_=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,T(e)),t[e]}});class B extends Array{mount(e){return this.forEach(n=>e(n)),this}}const A=(t=document)=>new Proxy({},{get:(e,n)=>function(r,s=[]){let[c,i]=v(r,s);const a=[...t.querySelectorAll(`[ref="${n}"]`)];return a.forEach(o=>{m({element:o,ctx:c}),w(o,i),o.$=A(o),o.mount=function(h){h(o)},o.state=function(h){m({element:o,ctx:h}),w(o,i)}}),a.length===1?a[0]:new B(...a)}}),F=A();f.$=F,f.h=_,f.hook=d,f.registerDirective=$,f.safeRemove=x,f.stream=l,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
