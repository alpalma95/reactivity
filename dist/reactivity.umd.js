(function(u,y){typeof exports=="object"&&typeof module<"u"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(u=typeof globalThis<"u"?globalThis:u||self,y(u.reactivity={}))})(this,function(u){"use strict";const y=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),L=(t,e)=>{const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(o){var s;return o.getAttribute("ref")==e||o.getAttributeNames().some(f=>f.includes(":"))&&e==="createScope"?NodeFilter.FILTER_ACCEPT:(s=o.getAttribute("ref"))!=null&&s.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let c;for(;c=r.nextNode();)n.push(c);return n},d=(t,e)=>typeof t=="function"?t(e):t.val??t;let h=null,m=new WeakMap;class R{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let l=t=>{h=new R(t),h.cb();let e=h;return h=null,e},T=(t,e)=>{if(h===null)return;let n;m.has(t)?n=m.get(t).get(e):m.set(t,new Map([[e,n=new Set]])),h._set.add(n),n.add(h)},D=(t,e,n)=>{if(!m.get(t))return;m.get(t).get(e).forEach(({cb:c})=>c(n))},F=t=>{if(Array.isArray(t)||typeof t!="function"&&typeof t!="object")return{val:t};if(typeof t=="function"){let e=w(1);return l(()=>e.val=t()),e}else return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?w(n):n]))},w=t=>{let e=F(t);return new Proxy(e,{get(n,r,c){return T(n,r),Reflect.get(n,r,c)},set(n,r,c,o){if(n[r]!==c){let s=n[r];Reflect.set(n,r,c,o),D(n,r,s)}return!0}})};const W={selector:"data-class",construct:function({element:t},e){const n=[];for(let[r,c]of Object.entries(e)){let o=l(()=>{!t.classList.contains(r)&&d(c,t)&&t.classList.add(r),t.classList.contains(r)&&!d(c,t)&&t.classList.remove(r)});n.push(o)}return n}},E=new WeakMap,A=(t,e)=>{let{isArray:n}=Array,r=E.get(t);r?E.set(t,n(e)?[...r,...e]:[...r,e]):E.set(t,[e])},S=t=>{var e;typeof(t==null?void 0:t.destroy)=="function"&&t.destroy(t),(e=E.get(t))==null||e.forEach(n=>{n.unhook()}),E.delete(t),t==null||t.remove()},j=(t,e,n)=>{let r=l(()=>t.setAttribute(e,d(n,t)));A(t,r)};class _ extends Array{mount(e){return this.forEach(n=>e(n)),this}}const N=(t,e)=>{var r;let n={};return(r=t.getAttributeNames())==null||r.forEach(c=>{c.startsWith(":")&&(n[c.replaceAll(":","")]=e[t.getAttribute(c)])&&t.removeAttribute(c)}),n},v=(t=document)=>new Proxy({},{get:(e,n)=>function(r,c=[]){let[o,s]=y(r,c);const f=[...L(t,n)];let a=n==="createScope"?o:null;return f.forEach(i=>{a&&(o=N(i,a)),g({element:i,ctx:o}),x(i,s),i.$=v(i),i.mount=function(p){p(i)},i.props=function(p){g({element:i,ctx:p}),x(i,s)}}),f.length===1?f[0]:new _(...f)}}),P=v(),$=(t,e,n)=>{const r=e.children,{trackBy:c}=e.dataset;t.length<r.length&&[...r].filter(s=>!t.some(f=>s.dataset.key==f[c])).forEach(s=>{S(e.querySelector(`[data-key="${s.dataset.key}"]`))}),t.forEach((o,s)=>{r[s]||e.appendChild(n(o));const f=o[c]==r[s].dataset.key,a=t.length===r.length,i=`[data-key="${o[c]}"]`;if(!f&&a){const p=e.querySelector(i)??n(o);e.replaceChild(p,r[s])}if(!f&&!a){const p=e.querySelector(i)??n(o);e.insertBefore(p,r[s])}})},q=(t,e)=>{var r;const n=((r=t.children[0])==null?void 0:r.cloneNode(!0))??t.querySelector("template").content.children[0];return n.$=v(n),n.props=function(c){g({element:n,ctx:c})},c=>(e(c)(n),n)},C=[{selector:"data-for",construct:function({element:t},e){var o;let[n,r]=e,c;return(o=t.dataset)!=null&&o.populate&&(n.val=JSON.parse(t.dataset.populate),t.removeAttribute("data-populate"),c=q(t,r)),c&&n.val.forEach((s,f)=>{const a=t.children[f];a.$=v(a),a.props=function(p){g({element:a,ctx:p})},r(s)(a)}),l(()=>{$(n.val,t,c??r)})}},{selector:"data-text",construct:function({element:t},e){return l(()=>{t.textContent===d(e,t)||t instanceof Comment||(t.textContent=d(e,t))})}},W,{selector:"data-show",construct:function({element:t},e){return l(()=>t.style.display=d(e,t)?null:"none")}},{selector:"data-if",construct:function(t,e){let n=new Comment("data-if");return l(()=>{!d(e,t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&d(e,t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!d(e,t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}},{selector:"data-model",construct:function({element:t},e){return t.addEventListener("input",()=>{e.val=t.value}),l(()=>{t.value=e.val})}}],I=Object.fromEntries(C.map(t=>[t.selector,t])),O=t=>{C.push(t)},g=t=>{for(const e in t.ctx){let n=I[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"||e==="destroy"){e==="init"&&t.ctx[e](t.element),t.element[e]=t.ctx[e];continue}if(n){let c=n.construct(t,t.ctx[e]);A(t.element,c);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}if(typeof t.ctx[e]=="function"||typeof t.ctx[e]=="object"){j(t.element,e,t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},x=(t,e)=>{e.length&&e.forEach(n=>{let r=n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?n:new Text(n);t.appendChild(r)})},B=t=>function(e,n=[]){let[r,c]=y(e,n),o={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return g(o),x(o.element,c),o.replaceWith??o.element},M=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,B(e)),t[e]}});u.$=P,u.h=M,u.hook=l,u.registerDirective=O,u.safeRemove=S,u.stream=w,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
