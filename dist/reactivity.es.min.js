const e=(e,t)=>(Array.isArray(e)&&(t=e,e={}),[e,t]),t=(e,t)=>{const n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,(function(e){var n;return e.getAttribute("ref")==t||e.getAttributeNames().some((e=>e.includes(":")))&&"createScope"===t?NodeFilter.FILTER_ACCEPT:null!=(n=e.getAttribute("ref"))&&n.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}));let o;for(;o=r.nextNode();)n.push(o);return n},n=(e,t)=>"function"==typeof e?e(t):e.val??e;let r=null,o=new WeakMap;class c{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach((e=>e.delete(this)))}}let l=e=>{r=new c(e),r.cb();let t=r;return r=null,t},s=e=>{let t=(e=>{if(Array.isArray(e)||"function"!=typeof e&&"object"!=typeof e)return{val:e};if("function"==typeof e){let t=s(1);return l((()=>t.val=e())),t}return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"object"==typeof t||"function"==typeof t?s(t):t])))})(e);return new Proxy(t,{get:(e,t,n)=>(((e,t)=>{if(null===r)return;let n;o.has(e)?n=o.get(e).get(t):o.set(e,new Map([[t,n=new Set]])),r._set.add(n),n.add(r)})(e,t),Reflect.get(e,t,n)),set(e,t,n,r){if(e[t]!==n){let c=e[t];Reflect.set(e,t,n,r),((e,t,n)=>{o.get(e)&&o.get(e).get(t).forEach((({cb:e})=>e(n)))})(e,t,c)}return!0}})};const a={selector:"data-class",construct:function({element:e},t){const r=[];for(let[o,c]of Object.entries(t)){let t=l((()=>{!e.classList.contains(o)&&n(c,e)&&e.classList.add(o),e.classList.contains(o)&&!n(c,e)&&e.classList.remove(o)}));r.push(t)}return r}},i=new WeakMap,u=(e,t)=>{let{isArray:n}=Array,r=i.get(e);r?i.set(e,n(t)?[...r,...t]:[...r,t]):i.set(e,[t])},f=e=>{var t;"function"==typeof e.destroy&&e.destroy(e),null==(t=i.get(e))||t.forEach((e=>{e.unhook()})),i.delete(e),null==e||e.remove()},m=(e,t,r)=>{let o=l((()=>e.setAttribute(t,n(r,e))));u(e,o)},d=[{selector:"data-for",construct:function({element:e},t){const[n,r]=t;return l((()=>{((e,t,n)=>{const r=t.children,{trackBy:o}=t.dataset;e.length<r.length&&[...r].filter((t=>!e.some((e=>t.dataset.key==e[o])))).forEach((e=>{f(t.querySelector(`[data-key="${e.dataset.key}"]`))})),e.forEach(((c,l)=>{r[l]||t.appendChild(n(c));const s=c[o]==r[l].dataset.key,a=e.length===r.length,i=`[data-key="${c[o]}"]`;if(!s&&a){const e=t.querySelector(i)??n(c);t.replaceChild(e,r[l])}if(!s&&!a){const e=t.querySelector(i)??n(c);t.insertBefore(e,r[l])}}))})(n.val,e,r)}))}},{selector:"data-text",construct:function({element:e},t){return l((()=>{e.textContent===n(t,e)||e instanceof Comment||(e.textContent=n(t,e))}))}},a,{selector:"data-show",construct:function({element:e},t){return l((()=>e.style.display=n(t,e)?null:"none"))}},{selector:"data-if",construct:function(e,t){let r=new Comment("data-if");return l((()=>{!n(t,e.element)&&!e.element.isConnected&&(e.replaceWith=r),r.isConnected&&n(t,e.element)&&(r.replaceWith(e.element),"function"==typeof e.element.init&&e.element.init(e.element)),e.element.isConnected&&!n(t,e.element)&&("function"==typeof e.element.destroy&&e.element.destroy(e.element),e.element.replaceWith(r))}))}},{selector:"data-model",construct:function({element:e},t){return e.addEventListener("input",(()=>{t.val=e.value})),l((()=>{e.value=t.val}))}}],h=Object.fromEntries(d.map((e=>[e.selector,e]))),p=e=>{d.push(e)},y=e=>{for(const t in e.ctx){let n=h[t];const r=t.startsWith("on")&&"function"==typeof e.ctx[t];if("init"!==t&&"destroy"!==t)if(n){let r=n.construct(e,e.ctx[t]);u(e.element,r)}else r?e.element.addEventListener(t.slice(2),e.ctx[t]):"function"!=typeof e.ctx[t]&&"object"!=typeof e.ctx[t]?e.element.setAttribute(t,e.ctx[t]):m(e.element,t,e.ctx[t]);else"init"===t&&e.ctx[t](e.element),e.element[t]=e.ctx[t]}},g=(e,t)=>{t.length&&t.forEach((t=>{let n=t instanceof HTMLElement||t instanceof Comment||t instanceof DocumentFragment?t:new Text(t);e.appendChild(n)}))},E=new Proxy({},{get:function(t,n){return n in t||Reflect.set(t,n,(t=>function(n,r=[]){let[o,c]=e(n,r),l={element:"fragment"===t?new DocumentFragment:document.createElement(t),ctx:o};return y(l),g(l.element,c),l.replaceWith??l.element})(n)),t[n]}});class x extends Array{mount(e){return this.forEach((t=>e(t))),this}}const b=(n=document)=>new Proxy({},{get:(r,o)=>function(r,c=[]){let[l,s]=e(r,c);const a=[...t(n,o)];let i="createScope"===o?l:null;return a.forEach((e=>{i&&(l=((e,t)=>{var n;let r={};return null==(n=e.getAttributeNames())||n.forEach((n=>{n.startsWith(":")&&(r[n.replaceAll(":","")]=t[e.getAttribute(n)])&&e.removeAttribute(n)})),r})(e,i)),y({element:e,ctx:l}),g(e,s),e.$=b(e),e.mount=function(t){t(e)},e.props=function(t){y({element:e,ctx:t}),g(e,s)}})),1===a.length?a[0]:new x(...a)}}),v=b();export{v as $,E as h,l as hook,p as registerDirective,f as safeRemove,s as stream};
//# sourceMappingURL=reactivity.min.js.map