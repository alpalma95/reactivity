let e=null,t=new WeakMap;class n{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach((e=>e.delete(this)))}}let l=t=>{e=new n(t),e.cb();let l=e;return e=null,l},o=n=>{let r=(e=>{if(Array.isArray(e)||"function"!=typeof e&&"object"!=typeof e)return{val:e};if("function"==typeof e){let t=o(1);return l((()=>t.val=e())),t}return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"object"==typeof t||"function"==typeof t?o(t):t])))})(n);return new Proxy(r,{get:(n,l,o)=>(((n,l)=>{if(null===e)return;let o;t.has(n)?o=t.get(n).get(l):t.set(n,new Map([[l,o=new Set]])),e._set.add(o),o.add(e)})(n,l),Reflect.get(n,l,o)),set(e,n,l,o){if(e[n]!==l){let r=e[n];Reflect.set(e,n,l,o),((e,n,l)=>{t.get(e)&&t.get(e).get(n).forEach((({cb:e})=>e(l)))})(e,n,r)}return!0}})};const r=new WeakMap,c=(e,t)=>r.has(e)?r.get(e).push(t):r.set(e,[t]),a=e=>{var t;"function"==typeof e.destroy&&e.destroy(e),null==(t=r.get(e))||t.forEach((e=>{Array.isArray(e)?e.forEach((e=>e.unhook())):e.unhook()})),r.delete(e),null==e||e.remove()},s=(e,t,n)=>{let o=l((()=>e.setAttribute(t,n(e))));c(e,o)},i=(e,t)=>(Array.isArray(e)&&(t=e,e={}),[e,t]),u=(e,t,n,l,o,r,c=null)=>{const a=e.clone.cloneNode(!0);if(a.setAttribute("ref",t[l]),"append"===r&&n.appendChild(a),"replace"===r||"insert"===r){const s=n.querySelector(`[data-key="${t[l]}"]`)??a;"replace"===r?n.replaceChild(s,o[c]):n.insertBefore(a,o[c]),s==a&&n.$[t[l]]().mount(e.template(t))}n.$[t[l]]().mount(e.template(t))},f=[{selector:"data-for",construct:function({element:e},t){var n,o;const[r,c]=t,s={template:c,clone:null};if(!r.val.length&&e.children.length){let t=[...e.querySelectorAll("[data-populate]")];t.forEach((e=>{const t=JSON.parse(e.dataset.populate);Object.keys(t).length&&(r.val=[...r.val,t]),e.removeAttribute("data-populate")}));let l=null==(n=t[0])?void 0:n.getAttribute("ref");r.val.length&&(null==(o=r.val)||o.forEach(((t,n)=>{const o=e.$[l]();1===o.length?o.mount(s.template(t)):o[n].mount(s.template(t))}))),s.clone=t[0].cloneNode(!0)}return l((()=>{((e,t,n)=>{const l=t.children,{trackBy:o}=t.dataset;e.length<l.length&&[...l].filter((t=>!e.some((e=>t.dataset.key==e[o])))).forEach((e=>{a(t.querySelector(`[data-key="${e.dataset.key}"]`))})),e.forEach(((r,c)=>{l[c]||(n.clone||t.appendChild(n.template(r)),n.clone&&u(n,r,t,o,l,"append"));const a=r[o]==l[c].dataset.key,s=e.length===l.length,i=`[data-key="${r[o]}"]`;if(!a&&s){if(!n.clone){const e=t.querySelector(i)??n.template(r);t.replaceChild(e,l[c])}n.clone&&u(n,r,t,o,l,"replace",c)}if(!a&&!s){if(!n.clone){const e=t.querySelector(i)??n.template(r);t.insertBefore(e,l[c])}n.clone&&u(n,r,t,o,l,"insert",c)}}))})(r.val,e,s)}))}},{selector:"data-text",construct:function({element:e},t){return l((()=>{e.textContent===t(e)||e instanceof Comment||(e.textContent=t(e))}))}},{selector:"data-class",construct:function({element:e},t){const n=[];for(let[o,r]of Object.entries(t)){let t=l((()=>{!e.classList.contains(o)&&r(e)&&e.classList.add(o),e.classList.contains(o)&&!r(e)&&e.classList.remove(o)}));n.push(t)}return n}},{selector:"data-show",construct:function({element:e},t){return l((()=>e.style.display=t(e)?null:"none"))}},{selector:"data-if",construct:function(e,t){let n=new Comment("data-if");return l((()=>{!t(e.element)&&!e.element.isConnected&&(e.replaceWith=n),n.isConnected&&t(e.element)&&(n.replaceWith(e.element),"function"==typeof e.element.init&&e.element.init(e.element)),e.element.isConnected&&!t(e.element)&&("function"==typeof e.element.destroy&&e.element.destroy(e.element),e.element.replaceWith(n))}))}}],m=Object.fromEntries(f.map((e=>[e.selector,e]))),p=e=>{f.push(e)},d=e=>{for(const t in e.ctx){let n=m[t];const l=t.startsWith("on")&&"function"==typeof e.ctx[t];if("init"!==t)if("destroy"!==t)if(n){let l=n.construct(e,e.ctx[t]);c(e.element,l)}else n||"function"!=typeof e.ctx[t]||l?l?e.element.addEventListener(t.slice(2),e.ctx[t]):e.element.setAttribute(t,e.ctx[t]):s(e.element,t,e.ctx[t]);else e.element.destroy=e.ctx[t];else e.ctx[t](e.element),e.element.init=e.ctx[t]}},h=(e,t)=>{t.length&&t.forEach((t=>{let n;n=t instanceof HTMLElement||t instanceof Comment||t instanceof DocumentFragment?t:new Text(t),e.appendChild(n)}))},y=new Proxy({},{get:function(e,t){return t in e||Reflect.set(e,t,(e=>function(t,n=[]){let[l,o]=i(t,n),r={element:"fragment"===e?new DocumentFragment:document.createElement(e),ctx:l};return d(r),h(r.element,o),r.replaceWith??r.element})(t)),e[t]}});class g extends Array{mount(e){return this.forEach((t=>e(t))),this}}const x=(e=document)=>new Proxy({},{get:(t,n)=>function(t,l=[]){let[o,r]=i(t,l);const c=[...e.querySelectorAll(`[ref="${n}"]`)];return c.forEach((e=>{d({element:e,ctx:o}),h(e,r),e.$=x(e),e.mount=function(t){t(e)},e.props=function(t){d({element:e,ctx:t}),h(e,r)}})),1===c.length?c[0]:new g(...c)}}),v=x();export{v as $,y as h,l as hook,p as registerDirective,a as safeRemove,o as stream};
//# sourceMappingURL=reactivity.min.js.map