let e=null,t=new WeakMap;class n{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach((e=>e.delete(this)))}}let r=t=>{e=new n(t),e.cb();let r=e;return e=null,r},o=n=>{let l=(e=>{if(Array.isArray(e)||"function"!=typeof e&&"object"!=typeof e)return{val:e};if("function"==typeof e){let t=o(1);return r((()=>t.val=e())),t}return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"object"==typeof t||"function"==typeof t?o(t):t])))})(n);return new Proxy(l,{get:(n,r,o)=>(((n,r)=>{if(null===e)return;let o;t.has(n)?o=t.get(n).get(r):t.set(n,new Map([[r,o=new Set]])),e._set.add(o),o.add(e)})(n,r),Reflect.get(n,r,o)),set(e,n,r,o){if(e[n]!==r){let l=e[n];Reflect.set(e,n,r,o),((e,n,r)=>{t.get(e)&&t.get(e).get(n).forEach((({cb:e})=>e(r)))})(e,n,l)}return!0}})};const l=[{selector:"data-for",construct:function({element:e},t){const[n,o]=t;return r((()=>{((e,t,n)=>{const r=t.children,{trackBy:o}=t.dataset;e.length<r.length&&[...r].filter((t=>!e.some((e=>t.dataset.key==e[o])))).forEach((e=>{u(t.querySelector(`[data-key="${e.dataset.key}"]`))})),e.forEach(((l,c)=>{r[c]||t.appendChild(n(l));const s=l[o]==r[c].dataset.key,a=e.length===r.length,i=`[data-key="${l[o]}"]`;if(!s&&a){const e=t.querySelector(i)??n(l);t.replaceChild(e,r[c])}if(!s&&!a){const e=t.querySelector(i)??n(l);t.insertBefore(e,r[c])}}))})(n.val,e,o)}))}},{selector:"data-text",construct:function({element:e},t){return r((()=>{let n="function"==typeof t?t(e):(null==t?void 0:t.val)??t;e.textContent===n||e instanceof Comment||(e.textContent=n)}))}},{selector:"data-class",construct:function({element:e},t){const n=[];for(let[o,l]of Object.entries(t)){let t=r((()=>{!e.classList.contains(o)&&l(e)&&e.classList.add(o),e.classList.contains(o)&&!l(e)&&e.classList.remove(o)}));n.push(t)}return n}},{selector:"data-show",construct:function({element:e},t){return r((()=>e.style.display=t(e)?null:"none"))}},{selector:"data-if",construct:function(e,t){let n=new Comment("data-if");return r((()=>{!t(e.element)&&!e.element.isConnected&&(e.replaceWith=n),n.isConnected&&t(e.element)&&(n.replaceWith(e.element),"function"==typeof e.element.init&&e.element.init(e.element)),e.element.isConnected&&!t(e.element)&&("function"==typeof e.element.destroy&&e.element.destroy(e.element),e.element.replaceWith(n))}))}},{selector:"data-model",construct:function({element:e},t){return e.addEventListener("input",(()=>{t.val=e.value})),r((()=>{e.value=t.val}))}}],c=Object.fromEntries(l.map((e=>[e.selector,e]))),s=e=>{l.push(e)},a=new WeakMap,i=(e,t)=>a.has(e)?a.get(e).push(t):a.set(e,[t]),u=e=>{var t;"function"==typeof e.destroy&&e.destroy(e),null==(t=a.get(e))||t.forEach((e=>{Array.isArray(e)?e.forEach((e=>e.unhook())):e.unhook()})),a.delete(e),null==e||e.remove()},f=(e,t,n)=>{let o=r((()=>e.setAttribute(t,n(e))));i(e,o)},m=(e,t)=>(Array.isArray(e)&&(t=e,e={}),[e,t]),d=(e,t)=>{const n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,(function(e){var n;return e.getAttribute("ref")==t||e.getAttributeNames().some((e=>e.includes(":")))&&"createScope"===t?NodeFilter.FILTER_ACCEPT:null!=(n=e.getAttribute("ref"))&&n.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}));let o;for(;o=r.nextNode();)n.push(o);return n},h=e=>{for(const t in e.ctx){let n=c[t];const r=t.startsWith("on")&&"function"==typeof e.ctx[t];if("init"!==t)if("destroy"!==t)if(n){let r=n.construct(e,e.ctx[t]);i(e.element,r)}else n||"function"!=typeof e.ctx[t]||r?r?e.element.addEventListener(t.slice(2),e.ctx[t]):e.element.setAttribute(t,e.ctx[t]):f(e.element,t,e.ctx[t]);else e.element.destroy=e.ctx[t];else e.ctx[t](e.element),e.element.init=e.ctx[t]}},p=(e,t)=>{t.length&&t.forEach((t=>{let n;n=t instanceof HTMLElement||t instanceof Comment||t instanceof DocumentFragment?t:new Text(t),e.appendChild(n)}))},y=new Proxy({},{get:function(e,t){return t in e||Reflect.set(e,t,(e=>function(t,n=[]){let[r,o]=m(t,n),l={element:"fragment"===e?new DocumentFragment:document.createElement(e),ctx:r};return h(l),p(l.element,o),l.replaceWith??l.element})(t)),e[t]}});class g extends Array{mount(e){return this.forEach((t=>e(t))),this}}const E=(e=document)=>new Proxy({},{get:(t,n)=>function(t,r=[]){let[o,l]=m(t,r);const c=[...d(e,n)];let s="createScope"===n?o:null;return c.forEach((e=>{s&&(o=((e,t)=>{var n;let r={};return null==(n=e.getAttributeNames())||n.forEach((n=>{n.startsWith(":")&&(r[n.replaceAll(":","")]=t[e.getAttribute(n)])&&e.removeAttribute(n)})),r})(e,s)),h({element:e,ctx:o}),p(e,l),e.$=E(e),e.mount=function(t){t(e)},e.props=function(t){h({element:e,ctx:t}),p(e,l)}})),1===c.length?c[0]:new g(...c)}}),x=E();export{x as $,y as h,r as hook,s as registerDirective,u as safeRemove,o as stream};
//# sourceMappingURL=reactivity.min.js.map