(function(f,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(f=typeof globalThis<"u"?globalThis:f||self,p(f.zborjs={}))})(this,function(f){"use strict";const p=(t,e)=>(Array.isArray(t)&&(e=t,t={}),[t,e]),D=(t,e)=>{const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(s){var i;return s.getAttribute("ref")==e||s.getAttributeNames().some(o=>o.includes(":"))&&e==="createScope"?NodeFilter.FILTER_ACCEPT:(i=s.getAttribute("ref"))!=null&&i.toUpperCase().includes("CONTROLLER")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let c;for(;c=r.nextNode();)n.push(c);return n},l=(t,e)=>typeof t=="function"?t(e):t.val??t;let h=null,y=new WeakMap;class j{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach(e=>e.delete(this))}}let d=t=>{h=new j(t),h.cb();let e=h;return h=null,e},m=t=>{let e=(n=>{if(Array.isArray(n)||typeof n!="function"&&typeof n!="object")return{val:n};if(typeof n=="function"){let r=m(1);return d(()=>r.val=n()),r}return Object.fromEntries(Object.entries(n).map(([r,c])=>[r,typeof c=="object"||typeof c=="function"?m(c):c]))})(t);return new Proxy(e,{get:(n,r,c)=>(((s,i)=>{if(h===null)return;let o;y.has(s)?o=y.get(s).get(i):y.set(s,new Map([[i,o=new Set]])),h._set.add(o),o.add(h)})(n,r),Reflect.get(n,r,c)),set:(n,r,c,s)=>(n[r]!==c&&(Reflect.set(n,r,c,s),((i,o)=>{y.get(i)&&y.get(i).get(o).forEach(({cb:u})=>u())})(n,r)),!0)})};const F={selector:"z-class",construct:function({element:t},e){const n=[];for(let[r,c]of Object.entries(e)){let s=d(()=>{!t.classList.contains(r)&&l(c,t)&&t.classList.add(r),t.classList.contains(r)&&!l(c,t)&&t.classList.remove(r)});n.push(s)}return n}},v=new WeakMap,A=(t,e)=>{let{isArray:n}=Array,r=v.get(t);r?v.set(t,n(e)?[...r,...e]:[...r,e]):v.set(t,[e])},S=t=>{var e;typeof(t==null?void 0:t.destroy)=="function"&&t.destroy(t),(e=v.get(t))==null||e.forEach(n=>{n.unhook()}),v.delete(t),t==null||t.remove()},W=(t,e,n)=>{let r=d(()=>t.setAttribute(e,l(n,t)));A(t,r)};class _ extends Array{mount(e){return this.forEach(n=>e(n)),this}}const P=(t,e)=>{var r;let n={};return(r=t.getAttributeNames())==null||r.forEach(c=>{c.startsWith(":")&&(n[c.replaceAll(":","")]=e[t.getAttribute(c)])&&t.removeAttribute(c)}),n},E=(t,e=[])=>{t.$=C(t),t.mount=function(n){n(t)},t.setProps=function(n){w({element:t,ctx:n}),e.length&&x(t,e)}},C=(t=document)=>new Proxy({},{get:(e,n)=>function(r,c=[]){let[s,i]=p(r,c);const o=[...D(t,n)];let u=n==="createScope"?s:null;return u&&o.push(t),o.forEach((a,g)=>{u&&(s=P(a,u)),w({element:a,ctx:s}),x(a,i),E(a,s)}),o.length===1?o[0]:new _(...o)}}),z=C(),L=(t,e,n)=>{const r=e.children,{trackBy:c}=e.dataset;t.length<r.length&&[...r].filter(i=>!t.some(o=>i.dataset.key==o[c])).forEach(i=>{S(e.querySelector(`[data-key="${i.dataset.key}"]`))}),t.forEach((s,i)=>{r[i]||e.appendChild(n(s));const o=s[c]==r[i].dataset.key,u=t.length===r.length,a=`[data-key="${s[c]}"]`;if(!o&&u){const g=e.querySelector(a)??n(s);e.replaceChild(g,r[i])}if(!o&&!u){const g=e.querySelector(a)??n(s);e.insertBefore(g,r[i])}})},N=(t,e)=>{var r;const n=((r=t.children[0])==null?void 0:r.cloneNode(!0))??t.querySelector("template").content.children[0];return E(n),c=>(e(c)(n),n)},R=[{selector:"z-for",construct:function({element:t},e){var i;let[n,r,c]=e,s;if((i=t.dataset)!=null&&i.populate){const o=JSON.parse(t.dataset.populate);n.val=c?o.map(c):o,t.removeAttribute("data-populate"),s=N(t,r)}return s&&n.val.forEach((o,u)=>{const a=t.children[u];E(a),r(o)(a)}),d(()=>{L(n.val,t,s??r)})}},{selector:"z-text",construct:function({element:t},e){return d(()=>{t.textContent===l(e,t)||t instanceof Comment||(t.textContent=l(e,t))})}},F,{selector:"z-show",construct:function({element:t},e){return d(()=>t.style.display=l(e,t)?null:"none")}},{selector:"z-if",construct:function(t,e){let n=new Comment("z-if");return d(()=>{!l(e,t.element)&&!t.element.isConnected&&(t.replaceWith=n),n.isConnected&&l(e,t.element)&&(n.replaceWith(t.element),typeof t.element.init=="function"&&t.element.init(t.element)),t.element.isConnected&&!l(e,t.element)&&(typeof t.element.destroy=="function"&&t.element.destroy(t.element),t.element.replaceWith(n))})}},{selector:"z-model",construct:function({element:t},e){return t.addEventListener("input",()=>{e.val=t.value}),d(()=>{t.value=e.val})}}],T=Object.fromEntries(R.map(t=>[t.selector,t])),q=t=>{R.push(t)},w=t=>{for(const e in t.ctx){let n=T[e];const r=e.startsWith("on")&&typeof t.ctx[e]=="function";if(e==="init"||e==="destroy"){e==="init"&&t.ctx[e](t.element),t.element[e]=t.ctx[e];continue}if(n){let c=n.construct(t,t.ctx[e]);A(t.element,c);continue}if(r){t.element.addEventListener(e.slice(2),t.ctx[e]);continue}if(typeof t.ctx[e]=="function"||typeof t.ctx[e]=="object"){W(t.element,e,t.ctx[e]);continue}t.element.setAttribute(e,t.ctx[e])}},x=(t,e)=>{e.length&&e.forEach(n=>{let r=n instanceof HTMLElement||n instanceof Comment||n instanceof DocumentFragment?n:new Text(n);t.appendChild(r)})},$=t=>function(e,n=[]){let[r,c]=p(e,n),s={element:t==="fragment"?new DocumentFragment:document.createElement(t),ctx:r};return w(s),x(s.element,c),s.replaceWith??s.element},I=new Proxy({},{get:function(t,e){return e in t||Reflect.set(t,e,$(e)),t[e]}});f.$=z,f.h=I,f.hook=d,f.registerDirective=q,f.safeRemove=S,f.stream=m,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
